<!doctype html>
<html class="h-full dark-mode">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Statistics Navigator Pro v6.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
  <style>
        body { box-sizing: border-box; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Space Grotesk', sans-serif; transition: background-color 0.4s ease, color 0.4s ease !important; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        #app-wrapper { display: flex; flex-direction: column; width: 100%; height: 100%; overflow: hidden; }
        header { flex-shrink: 0; width: 100%; max-height: 200px; overflow-y: auto; z-index: 50; }
        header::-webkit-scrollbar { width: 6px; }
        header::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.02); }
        header::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 3px; }
        main { flex: 1; width: 100%; overflow-y: scroll; overflow-x: hidden; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        main::-webkit-scrollbar { width: 12px; }
        main::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.03); }
        main::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #6366f1, #8b5cf6); border-radius: 10px; box-shadow: 0 0 10px rgba(99, 102, 241, 0.4); }
        main::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #8b5cf6, #a78bfa); box-shadow: 0 0 15px rgba(139, 92, 246, 0.6); }
        @keyframes slide-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px rgba(99, 102, 241, 0.3); } 50% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.6); } }
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
        .animate-slide-up { animation: slide-up 0.6s ease-out forwards; }
        .animate-spin { animation: spin 6s linear infinite; }
        .animate-bounce { animation: bounce 1s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-shimmer { animation: shimmer 2s infinite; background-size: 1000px 100%; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .glass-card:hover { background: rgba(255, 255, 255, 0.08); border-color: rgba(255, 255, 255, 0.2); transform: translateY(-2px); }
        .nav-btn { position: relative; transition: all 0.3s ease; padding: 12px 24px; border-radius: 12px; font-weight: 600; border: 2px solid transparent; cursor: pointer; }
        .nav-btn.inactive { background: rgba(255, 255, 255, 0.05); color: #94a3b8; }
        .nav-btn.inactive:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }
        .nav-btn.active { color: white; border-color: currentColor; box-shadow: 0 0 20px currentColor; transform: scale(1.05); }
        .mode-toggle { position: relative; width: 60px; height: 32px; border-radius: 20px; background: rgba(100, 100, 100, 0.3); cursor: pointer; transition: all 0.4s ease; display: flex; align-items: center; justify-content: space-between; padding: 0 6px; }
        .mode-toggle.light { background: rgba(255, 193, 7, 0.2); }
        .mode-toggle.dark { background: rgba(59, 130, 246, 0.2); }
        .toast { position: fixed; bottom: 30px; right: 30px; padding: 16px 24px; border-radius: 12px; color: white; font-weight: 600; animation: slide-up 0.4s ease-out; z-index: 9999; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); }
        .toast.success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast.info { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        :root.dark-mode { --bg-primary: #0f172a; --bg-secondary: #1e293b; --text-primary: #f1f5f9; --text-secondary: #94a3b8; --card-bg: rgba(255, 255, 255, 0.05); --card-border: rgba(255, 255, 255, 0.1); }
        :root.light-mode { --bg-primary: #f8fafc; --bg-secondary: #f1f5f9; --text-primary: #0f172a; --text-secondary: #475569; --card-bg: rgba(99, 102, 241, 0.08); --card-border: rgba(99, 102, 241, 0.2); }
        body.dark-mode { background-color: #0f172a !important; color: #f1f5f9 !important; }
        body.light-mode { background-color: #f8fafc !important; color: #0f172a !important; }
        .dark-mode .glass-card { background: rgba(15, 23, 42, 0.6) !important; border-color: rgba(255, 255, 255, 0.1) !important; color: #f1f5f9 !important; }
        .light-mode .glass-card { background: rgba(255, 255, 255, 0.85) !important; border-color: rgba(99, 102, 241, 0.25) !important; color: #0f172a !important; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
        .dark-mode header { background: rgba(15, 23, 42, 0.95) !important; border-color: rgba(255, 255, 255, 0.1) !important; color: #f1f5f9 !important; }
        .light-mode header { background: rgba(255, 255, 255, 0.95) !important; border-color: rgba(99, 102, 241, 0.2) !important; color: #0f172a !important; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .dark-mode textarea, .dark-mode input { background-color: #1e293b !important; border-color: #334155 !important; color: #f1f5f9 !important; }
        .light-mode textarea, .light-mode input { background-color: #ffffff !important; border-color: #cbd5e1 !important; color: #0f172a !important; }
        .light-mode .nav-btn.inactive { background: rgba(99, 102, 241, 0.1); color: #0f172a; border-color: rgba(99, 102, 241, 0.2); }
        .light-mode .tab-btn { background: rgba(99, 102, 241, 0.1); color: #0f172a; border-color: rgba(99, 102, 241, 0.2); }
        .light-mode .tab-btn:hover { background: rgba(99, 102, 241, 0.15); border-color: #6366f1; }
        .light-mode .tab-btn.active { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
        .data-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
        .data-table thead { background: linear-gradient(90deg, #6366f1, #8b5cf6); color: white; }
        .data-table th { padding: 12px; text-align: left; font-weight: 700; }
        .data-table td { padding: 12px; border-bottom: 1px solid var(--card-border); transition: all 0.2s ease; }
        .dark-mode .data-table td { border-bottom-color: rgba(255, 255, 255, 0.1); }
        .light-mode .data-table td { border-bottom-color: rgba(99, 102, 241, 0.15); }
        .data-table tbody tr:hover { background: var(--card-bg); transform: scale(1.01); }
        .chart-container { position: relative; height: 350px; margin: 20px 0; padding: 20px; border-radius: 12px; background: var(--card-bg); border: 1px solid var(--card-border); }
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .quick-stat { background: var(--card-bg); padding: 12px; border-radius: 8px; text-align: center; border: 1px solid var(--card-border); transition: all 0.3s ease; }
        .quick-stat:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2); }
        .quick-stat-value { font-size: 24px; font-weight: 700; color: #6366f1; }
        .quick-stat-label { font-size: 10px; color: var(--text-secondary); margin-top: 4px; }
        .tab-container { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; overflow-x: auto; }
        .tab-btn { padding: 10px 16px; border-radius: 8px; border: 2px solid transparent; background: var(--card-bg); color: var(--text-primary); cursor: pointer; transition: all 0.3s ease; font-weight: 600; white-space: nowrap; flex-shrink: 0; }
        .tab-btn:hover { background: rgba(99, 102, 241, 0.1); border-color: #6366f1; }
        .tab-btn.active { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slide-up 0.4s ease-out; }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; transition: all 0.3s ease; border: none; cursor: pointer; padding: 10px 20px; border-radius: 8px; font-weight: 600; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .btn-primary:active { transform: translateY(0); }
        .progress-bar { height: 8px; border-radius: 10px; background: rgba(255, 255, 255, 0.1); overflow: hidden; position: relative; }
        .light-mode .progress-bar { background: rgba(99, 102, 241, 0.1); }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); background: linear-gradient(90deg, #6366f1, #8b5cf6); box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }
        .reward-badge { display: inline-flex; flex-direction: column; align-items: center; justify-content: center; width: 100px; height: 100px; border-radius: 12px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.2); font-size: 40px; transition: all 0.3s ease; cursor: pointer; margin: 5px; }
        .reward-badge:hover { transform: scale(1.1) rotate(5deg); border-color: rgba(255, 255, 255, 0.5); box-shadow: 0 0 30px rgba(255, 255, 255, 0.1); }
        .reward-badge.earned { background: rgba(16, 185, 129, 0.1); border-color: #10b981; box-shadow: 0 0 30px rgba(16, 185, 129, 0.3); }
        .metric-card { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); border: 1px solid rgba(99, 102, 241, 0.2); padding: 16px; border-radius: 8px; text-align: center; }
        .light-mode .metric-card { background: rgba(99, 102, 241, 0.08); border-color: rgba(99, 102, 241, 0.25); }
        .metric-value { font-size: 28px; font-weight: 700; color: #6366f1; }
        .metric-label { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }
        .metric-icon { font-size: 24px; margin-bottom: 8px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin: 16px 0; }
        .success-badge { background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 8px 16px; border-radius: 20px; font-weight: 700; display: inline-block; margin: 8px 0; }
        .page-content { animation: slide-up 0.5s ease-out; }
        .page-content.hidden { display: none; }
        .highlight { color: #6366f1; }
        .feature-box { background: var(--card-bg); padding: 16px; border-radius: 12px; border: 1px solid var(--card-border); display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
        .feature-icon { font-size: 28px; flex-shrink: 0; }
        .feature-text { flex: 1; }
        .feature-text-title { font-weight: 700; margin-bottom: 4px; }
        .feature-text-desc { font-size: 13px; color: var(--text-secondary); }
        .spec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
        .spec-item { background: var(--card-bg); padding: 16px; border-radius: 8px; border: 1px solid var(--card-border); text-align: center; }
        .spec-value { font-size: 24px; font-weight: 700; color: #6366f1; }
        .spec-label { font-size: 12px; color: var(--text-secondary); margin-top: 6px; }
        .prediction-box { background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15)); border: 2px solid rgba(99, 102, 241, 0.3); padding: 20px; border-radius: 12px; text-align: center; }
        .stat-comparison { background: var(--card-bg); padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin: 8px 0; border-left: 4px solid #6366f1; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full dark-mode overflow-hidden">
  <div id="app-wrapper">
   <header class="border-b border-slate-800/50 bg-slate-950/50 backdrop-blur-md sticky top-0 z-50 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 py-4">
     <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
       <div class="text-4xl animate-bounce">
        ğŸ“Š
       </div>
       <div>
        <h1 class="text-2xl font-bold highlight">Statistics Pro v6.0</h1>
        <p class="text-xs text-slate-500">âœ¨ Enhanced with AI Predictions &amp; Regression</p>
       </div>
      </div>
      <div class="flex items-center gap-4">
       <div class="mode-toggle dark" id="mode-toggle" onclick="toggleDarkLight()"><span>â˜€ï¸</span> <span>ğŸŒ™</span>
       </div>
      </div>
     </div>
     <nav class="flex flex-wrap gap-2 overflow-x-auto pb-2"><button onclick="showPage('calculator')" class="nav-btn active" id="nav-calculator">ğŸ§® Calc</button> <button onclick="showPage('games')" class="nav-btn inactive" id="nav-games">ğŸ® Games</button> <button onclick="showPage('advanced')" class="nav-btn inactive" id="nav-advanced">ğŸ”¬ Advanced</button> <button onclick="showPage('prediction')" class="nav-btn inactive" id="nav-prediction">ğŸ”® Predict</button> <button onclick="showPage('regression')" class="nav-btn inactive" id="nav-regression">ğŸ“ Regress</button> <button onclick="showPage('probability')" class="nav-btn inactive" id="nav-probability">ğŸ² Prob</button> <button onclick="showPage('benchmark')" class="nav-btn inactive" id="nav-benchmark">âš¡ Bench</button> <button onclick="showPage('study')" class="nav-btn inactive" id="nav-study">ğŸ“š Study</button> <button onclick="showPage('visualizer')" class="nav-btn inactive" id="nav-visualizer">ğŸ“ˆ Charts</button> <button onclick="showPage('tabledata')" class="nav-btn inactive" id="nav-tabledata">ğŸ“‹ Tables</button> <button onclick="showPage('problems')" class="nav-btn inactive" id="nav-problems">ğŸ“ Problems</button> <button onclick="showPage('progress')" class="nav-btn inactive" id="nav-progress">ğŸ“Š Progress</button> <button onclick="showPage('leaderboard')" class="nav-btn inactive" id="nav-leaderboard">ğŸ† Leaders</button> <button onclick="showPage('rewards')" class="nav-btn inactive" id="nav-rewards">ğŸ Rewards</button> <button onclick="showPage('system')" class="nav-btn inactive" id="nav-system">ğŸ’» System</button> <button onclick="showPage('settings')" class="nav-btn inactive" id="nav-settings">âš™ï¸ Settings</button>
     </nav>
    </div>
   </header>
   <main>
    <div class="max-w-7xl mx-auto px-4 py-8"><!-- Prediction Page -->
     <section id="page-prediction" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ”® Data Prediction Engine</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div>
         <h3 class="font-bold mb-3">Historical Data</h3><textarea id="pred-input" class="w-full h-32 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="10, 15, 20, 25, 30"></textarea> <button onclick="runPrediction()" class="btn-primary w-full mt-3">ğŸ”® Predict Next Values</button>
        </div>
        <div>
         <h3 class="font-bold mb-3">Predictions</h3>
         <div id="prediction-result" class="space-y-2 hidden max-h-96 overflow-y-auto">
          <div class="prediction-box">
           <div class="text-sm text-slate-400">
            Next Value
           </div>
           <div class="text-3xl font-bold text-indigo-400" id="pred-next">
            -
           </div>
          </div>
          <div class="prediction-box">
           <div class="text-sm text-slate-400">
            In 2 Steps
           </div>
           <div class="text-3xl font-bold text-purple-400" id="pred-next2">
            -
           </div>
          </div>
          <div class="prediction-box">
           <div class="text-sm text-slate-400">
            In 3 Steps
           </div>
           <div class="text-3xl font-bold text-pink-400" id="pred-next3">
            -
           </div>
          </div>
          <div class="prediction-box">
           <div class="text-sm text-slate-400">
            Confidence
           </div>
           <div class="text-2xl font-bold text-emerald-400" id="pred-confidence">
            -
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Regression Page -->
     <section id="page-regression" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ“ Linear Regression Analysis</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div>
         <h3 class="font-bold mb-3">X Values</h3><textarea id="reg-x" class="w-full h-20 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="1, 2, 3, 4, 5"></textarea>
         <h3 class="font-bold mb-3 mt-4">Y Values</h3><textarea id="reg-y" class="w-full h-20 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="2, 4, 6, 8, 10"></textarea> <button onclick="runRegression()" class="btn-primary w-full mt-4">ğŸ“ Calculate Regression</button>
        </div>
        <div id="regression-result" class="space-y-3 hidden">
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ“Š
          </div>
          <div class="metric-value" id="reg-slope">
           -
          </div>
          <div class="metric-label">
           Slope (m)
          </div>
         </div>
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ“ˆ
          </div>
          <div class="metric-value" id="reg-intercept">
           -
          </div>
          <div class="metric-label">
           Intercept (b)
          </div>
         </div>
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ“
          </div>
          <div class="metric-value" id="reg-r2">
           -
          </div>
          <div class="metric-label">
           RÂ² Value
          </div>
         </div>
         <div class="prediction-box mt-3">
          <div class="text-sm text-slate-400">
           Equation
          </div>
          <div class="text-lg font-bold text-indigo-400 mt-2" id="reg-equation">
           y = mx + b
          </div>
         </div>
        </div>
       </div>
       <div id="regression-chart" class="chart-container hidden mt-6">
        <canvas id="regressionChart"></canvas>
       </div>
      </div>
     </section><!-- Probability Page -->
     <section id="page-probability" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ² Probability &amp; Distribution</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div>
         <h3 class="font-bold mb-3">Binomial Probability</h3>
         <div class="space-y-2"><input type="number" id="bin-n" placeholder="n (trials)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="10"> <input type="number" id="bin-p" placeholder="p (probability 0-1)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="0.5" step="0.01"> <input type="number" id="bin-k" placeholder="k (successes)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="5"> <button onclick="calculateBinomial()" class="btn-primary w-full">Calculate</button>
         </div>
         <div id="binomial-result" class="mt-3 hidden">
          <div class="metric-card">
           <div class="metric-value" id="bin-prob">
            -
           </div>
           <div class="metric-label">
            P(X = k)
           </div>
          </div>
         </div>
        </div>
        <div>
         <h3 class="font-bold mb-3">Normal Distribution</h3>
         <div class="space-y-2"><input type="number" id="norm-mean" placeholder="Î¼ (mean)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="0"> <input type="number" id="norm-std" placeholder="Ïƒ (std dev)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="1" step="0.1"> <input type="number" id="norm-x" placeholder="x (value)" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2" value="0"> <button onclick="calculateNormal()" class="btn-primary w-full">Calculate</button>
         </div>
         <div id="normal-result" class="mt-3 hidden">
          <div class="metric-card">
           <div class="metric-value" id="norm-prob">
            -
           </div>
           <div class="metric-label">
            P(X â‰¤ x)
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Benchmark Page -->
     <section id="page-benchmark" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">âš¡ Performance Benchmark</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div>
         <h3 class="font-bold mb-3">Your Dataset</h3><textarea id="bench-data" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Numbers to compare"></textarea> <button onclick="runBenchmark()" class="btn-primary w-full mt-3">âš¡ Run Benchmark</button>
        </div>
        <div id="benchmark-result" class="space-y-2 hidden">
         <div class="stat-comparison"><span>vs Global Average</span> <span id="bench-global" class="font-bold text-emerald-400">-</span>
         </div>
         <div class="stat-comparison"><span>vs Similar Size</span> <span id="bench-similar" class="font-bold text-indigo-400">-</span>
         </div>
         <div class="stat-comparison"><span>Percentile</span> <span id="bench-percentile" class="font-bold text-purple-400">-</span>
         </div>
         <div class="stat-comparison"><span>Performance</span> <span id="bench-rating" class="font-bold text-pink-400">-</span>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Games Page -->
     <section id="page-games" class="page-content hidden">
      <div class="grid md:grid-cols-2 gap-6 animate-slide-up">
       <div class="glass-card rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">ğŸ¯ Guess Challenge</h3>
        <p class="text-sm text-slate-400 mb-4">Guess the statistic!</p>
        <div id="guess-game" class="hidden">
         <div id="guess-hint" class="text-2xl font-bold mb-3 text-center">
          ?
         </div><input type="number" id="guess-input" placeholder="Guess" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 mb-2" step="any">
         <div class="flex gap-2"><button onclick="submitGuess()" class="btn-primary flex-1">Check</button> <button onclick="giveUpGuess()" class="flex-1 py-2 rounded-lg bg-slate-800/50">Skip</button>
         </div>
         <div id="guess-feedback" class="mt-3 hidden"></div>
        </div><button onclick="startGuessGame()" id="start-guess" class="btn-primary w-full">Start Game</button>
       </div>
       <div class="glass-card rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">ğŸ§© Pattern Quest</h3>
        <div id="pattern-game" class="hidden bg-slate-900/50 p-4 rounded-xl">
         <div id="pattern-sequence" class="text-lg font-bold mb-3 text-center"></div><input type="number" id="pattern-input" placeholder="Next number" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 mb-2"> <button onclick="checkPattern()" class="btn-primary w-full">Check</button>
         <div id="pattern-feedback" class="mt-3 hidden"></div>
        </div><button onclick="startPatternGame()" id="start-pattern" class="btn-primary w-full">Start</button>
       </div>
       <div class="glass-card rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">âš¡ Speed Quest</h3>
        <div class="quick-stats mb-3">
         <div class="quick-stat">
          <div class="quick-stat-value" id="speed-correct">
           0
          </div>
          <div class="quick-stat-label">
           Correct
          </div>
         </div>
         <div class="quick-stat">
          <div class="quick-stat-value" id="speed-time">
           30
          </div>
          <div class="quick-stat-label">
           Seconds
          </div>
         </div>
        </div><button onclick="startSpeedChallenge()" class="btn-primary w-full">Start Challenge</button>
        <div id="speed-game" class="hidden mt-3">
         <div id="speed-question" class="text-sm mb-3"></div><input type="number" id="speed-input" placeholder="Answer" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 mb-2" step="any"> <button onclick="submitSpeedAnswer()" class="btn-primary w-full">Submit</button>
        </div>
       </div>
       <div class="glass-card rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">ğŸ° Lucky Spin</h3>
        <div class="flex justify-center mb-4">
         <div id="luck-wheel" style="width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(from 0deg, #6366f1, #8b5cf6, #ec4899, #f59e0b, #10b981); display: flex; align-items: center; justify-content: center; font-size: 50px; cursor: pointer; transition: transform 0.6s ease;" class="cursor-pointer" onclick="spinWheel()">
          ğŸ¡
         </div>
        </div><button onclick="spinWheel()" class="btn-primary w-full">Spin Now!</button>
        <div id="luck-result" class="mt-3 hidden"></div>
       </div>
      </div>
     </section><!-- Advanced Analysis -->
     <section id="page-advanced" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ”¬ Advanced Analysis</h2>
       <div class="tab-container"><button class="tab-btn active" onclick="switchAdvancedTab('variance')">ğŸ“Š Variance</button> <button class="tab-btn" onclick="switchAdvancedTab('quartiles')">ğŸ“ˆ Quartiles</button> <button class="tab-btn" onclick="switchAdvancedTab('outliers')">ğŸ¯ Outliers</button> <button class="tab-btn" onclick="switchAdvancedTab('correlation')">ğŸ”— Correlation</button>
       </div>
       <div id="tab-variance" class="tab-content active"><textarea id="variance-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Enter numbers"></textarea> <button onclick="calculateVariance()" class="btn-primary w-full mt-3">Calculate</button>
        <div id="variance-result" class="mt-4 grid md:grid-cols-3 gap-4 hidden">
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ“Š
          </div>
          <div class="metric-value" id="variance-value">
           -
          </div>
          <div class="metric-label">
           Variance
          </div>
         </div>
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ“ˆ
          </div>
          <div class="metric-value" id="stdev-value">
           -
          </div>
          <div class="metric-label">
           Std Dev
          </div>
         </div>
         <div class="metric-card">
          <div class="metric-icon">
           ğŸ¯
          </div>
          <div class="metric-value" id="cv-value">
           -
          </div>
          <div class="metric-label">
           Coef Var
          </div>
         </div>
        </div>
       </div>
       <div id="tab-quartiles" class="tab-content hidden"><textarea id="quartiles-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Enter numbers"></textarea> <button onclick="calculateQuartiles()" class="btn-primary w-full mt-3">Calculate Quartiles</button>
        <div id="quartiles-result" class="mt-4 hidden overflow-x-auto">
         <table class="data-table">
          <thead>
           <tr>
            <th>Metric</th>
            <th>Value</th>
           </tr>
          </thead>
          <tbody id="quartiles-body"></tbody>
         </table>
        </div>
       </div>
       <div id="tab-outliers" class="tab-content hidden"><textarea id="outliers-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Enter numbers"></textarea> <button onclick="findOutliers()" class="btn-primary w-full mt-3">Find Outliers</button>
        <div id="outliers-result" class="mt-4 hidden space-y-2"></div>
       </div>
       <div id="tab-correlation" class="tab-content hidden">
        <div class="grid md:grid-cols-2 gap-4 mb-4"><textarea id="corr-x" class="h-20 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="X values"></textarea> <textarea id="corr-y" class="h-20 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Y values"></textarea>
        </div><button onclick="calculateCorrelation()" class="btn-primary w-full">Calculate</button>
        <div id="correlation-result" class="mt-4 hidden">
         <div class="metric-card">
          <div class="metric-value" id="correlation-value">
           -
          </div>
          <div class="metric-label">
           Correlation (r)
          </div>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Study Mode -->
     <section id="page-study" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ“š Study Mode</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-2"><button onclick="loadLesson('mean')" class="w-full py-3 rounded-lg bg-indigo-600/20 border-2 border-indigo-500/50 font-semibold hover:bg-indigo-600/30">ğŸ“Š Mean</button> <button onclick="loadLesson('median')" class="w-full py-3 rounded-lg bg-purple-600/20 border-2 border-purple-500/50 font-semibold hover:bg-purple-600/30">ğŸª Median</button> <button onclick="loadLesson('mode')" class="w-full py-3 rounded-lg bg-pink-600/20 border-2 border-pink-500/50 font-semibold hover:bg-pink-600/30">ğŸ¯ Mode</button> <button onclick="loadLesson('range')" class="w-full py-3 rounded-lg bg-emerald-600/20 border-2 border-emerald-500/50 font-semibold hover:bg-emerald-600/30">ğŸ“ Range</button>
        </div>
        <div id="lesson-content" class="bg-slate-900/50 p-4 rounded-xl h-64 overflow-y-auto">
         <p class="text-slate-400 text-center mt-8">Select a lesson</p>
        </div>
       </div>
      </div>
     </section><!-- Calculator Page -->
     <section id="page-calculator" class="page-content">
      <div class="grid md:grid-cols-2 gap-6">
       <div class="glass-card rounded-2xl p-6 animate-slide-up">
        <h2 class="text-xl font-bold mb-4">ğŸ“Š Mean</h2><textarea id="mean-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Numbers separated by commas"></textarea> <button onclick="calculateMean()" class="btn-primary w-full mt-4">Calculate</button>
        <div id="mean-result" class="mt-4 hidden">
         <div class="text-sm text-slate-400 mb-1">
          Mean (Average)
         </div>
         <div class="result-display bg-slate-900/50 text-indigo-400 mono text-3xl font-bold p-4 rounded text-center" id="mean-value">
          -
         </div>
        </div>
       </div>
       <div class="glass-card rounded-2xl p-6 animate-slide-up" style="animation-delay: 0.1s;">
        <h2 class="text-xl font-bold mb-4">ğŸ¯ Mode</h2><textarea id="mode-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Numbers"></textarea> <button onclick="calculateMode()" class="btn-primary w-full mt-4">Calculate</button>
        <div id="mode-result" class="mt-4 hidden">
         <div class="text-sm text-slate-400 mb-1">
          Mode
         </div>
         <div class="result-display bg-slate-900/50 text-purple-400 mono text-3xl font-bold p-4 rounded text-center" id="mode-value">
          -
         </div>
        </div>
       </div>
       <div class="glass-card rounded-2xl p-6 animate-slide-up" style="animation-delay: 0.2s;">
        <h2 class="text-xl font-bold mb-4">ğŸ“ Range</h2><textarea id="range-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Numbers"></textarea> <button onclick="calculateRange()" class="btn-primary w-full mt-4">Calculate</button>
        <div id="range-result" class="mt-4 hidden">
         <div class="text-sm text-slate-400 mb-1">
          Range
         </div>
         <div class="result-display bg-slate-900/50 text-pink-400 mono text-3xl font-bold p-4 rounded text-center" id="range-value">
          -
         </div>
        </div>
       </div>
       <div class="glass-card rounded-2xl p-6 animate-slide-up" style="animation-delay: 0.3s;">
        <h2 class="text-xl font-bold mb-4">ğŸª Median</h2><textarea id="median-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="Numbers"></textarea> <button onclick="calculateMedian()" class="btn-primary w-full mt-4">Calculate</button>
        <div id="median-result" class="mt-4 hidden">
         <div class="text-sm text-slate-400 mb-1">
          Median
         </div>
         <div class="result-display bg-slate-900/50 text-emerald-400 mono text-3xl font-bold p-4 rounded text-center" id="median-value">
          -
         </div>
        </div>
       </div>
      </div>
     </section><!-- Charts Page -->
     <section id="page-visualizer" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Graph Visualizer</h2><textarea id="viz-input" class="w-full h-20 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="10, 20, 15, 30"></textarea> <button onclick="processVisualizerData()" class="btn-primary w-full mt-3 mb-4">Process Data</button>
       <div class="grid md:grid-cols-2 gap-4 mb-4">
        <div class="chart-container">
         <canvas id="lineChart"></canvas>
        </div>
        <div class="chart-container">
         <canvas id="barChart"></canvas>
        </div>
       </div>
       <div class="chart-container">
        <canvas id="pieChart"></canvas>
       </div>
      </div>
     </section><!-- Tables Page -->
     <section id="page-tabledata" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-4">ğŸ“‹ Data Tables</h2><textarea id="table-input" class="w-full h-24 bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mono focus:outline-none resize-none" placeholder="45, 67, 52"></textarea>
       <div class="flex gap-2 mt-3 flex-wrap"><button onclick="generateRawTable()" class="btn-primary flex-1 min-w-fit">Raw Table</button> <button onclick="generateFrequencyTable()" class="btn-primary flex-1 min-w-fit">Frequency</button> <button onclick="generateStatsTable()" class="btn-primary flex-1 min-w-fit">Stats</button>
       </div>
       <div id="table-container" class="overflow-x-auto mt-4"></div>
      </div>
     </section><!-- Problems Page -->
     <section id="page-problems" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-4">ğŸ“ Word Problems</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div><button onclick="generateProblem('mean')" class="btn-primary w-full py-2 mb-2">ğŸ“Š Mean</button> <button onclick="generateProblem('mode')" class="btn-primary w-full py-2 mb-2">ğŸ¯ Mode</button> <button onclick="generateProblem('range')" class="btn-primary w-full py-2 mb-2">ğŸ“ Range</button> <button onclick="generateProblem('median')" class="btn-primary w-full py-2">ğŸª Median</button>
        </div>
        <div id="problem-area" class="hidden">
         <div id="problem-text" class="text-base font-medium mb-4 leading-relaxed"></div><input type="number" id="problem-answer" placeholder="Your answer" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-3 mb-3 text-white mono" step="any">
         <div class="flex gap-2"><button onclick="checkProblemAnswer()" class="btn-primary flex-1">âœ“ Check</button> <button onclick="skipProblem()" class="flex-1 py-2 rounded-lg font-semibold bg-slate-800/50">âŠ˜ Skip</button>
         </div>
         <div id="problem-feedback" class="mt-4 hidden"></div>
        </div>
       </div>
      </div>
     </section><!-- Progress Page -->
     <section id="page-progress" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ“Š Learning Progress</h2>
       <div class="grid md:grid-cols-2 gap-6">
        <div>
         <h3 class="font-semibold mb-3">Mean Mastery</h3>
         <div class="progress-bar">
          <div class="progress-fill" id="progress-mean" style="width: 0%"></div>
         </div>
         <p class="text-xs text-slate-400 mt-1" id="progress-mean-text">0%</p>
        </div>
        <div>
         <h3 class="font-semibold mb-3">Mode Mastery</h3>
         <div class="progress-bar">
          <div class="progress-fill" id="progress-mode" style="width: 0%"></div>
         </div>
         <p class="text-xs text-slate-400 mt-1" id="progress-mode-text">0%</p>
        </div>
        <div>
         <h3 class="font-semibold mb-3">Range Mastery</h3>
         <div class="progress-bar">
          <div class="progress-fill" id="progress-range" style="width: 0%"></div>
         </div>
         <p class="text-xs text-slate-400 mt-1" id="progress-range-text">0%</p>
        </div>
        <div>
         <h3 class="font-semibold mb-3">Median Mastery</h3>
         <div class="progress-bar">
          <div class="progress-fill" id="progress-median" style="width: 0%"></div>
         </div>
         <p class="text-xs text-slate-400 mt-1" id="progress-median-text">0%</p>
        </div>
       </div>
      </div>
     </section><!-- Leaderboard Page -->
     <section id="page-leaderboard" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ† Leaderboard</h2>
       <div id="leaderboard-list" class="space-y-2"></div>
      </div>
     </section><!-- Rewards Page -->
     <section id="page-rewards" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ Achievements</h2>
       <div class="flex flex-wrap justify-center">
        <div class="reward-badge" id="reward-first" title="First Calc">
         ğŸ¯
        </div>
        <div class="reward-badge" id="reward-mean" title="Mean Master">
         ğŸ“Š
        </div>
        <div class="reward-badge" id="reward-mode" title="Mode Expert">
         ğŸ¯
        </div>
        <div class="reward-badge" id="reward-range" title="Range Master">
         ğŸ“
        </div>
        <div class="reward-badge" id="reward-median" title="Median Expert">
         ğŸª
        </div>
        <div class="reward-badge" id="reward-prediction" title="Prediction Expert">
         ğŸ”®
        </div>
       </div>
      </div>
     </section><!-- System Page -->
     <section id="page-system" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">ğŸ’» System v6.0</h2>
       <div class="mb-8">
        <h3 class="text-lg font-bold mb-4">âœ¨ NEW in v6.0</h3>
        <div class="space-y-2">
         <div class="feature-box">
          <div class="feature-icon">
           ğŸ”®
          </div>
          <div class="feature-text">
           <div class="feature-text-title">
            Predictive Analytics
           </div>
           <div class="feature-text-desc">
            AI-powered predictions for next values with confidence scoring
           </div>
          </div>
         </div>
         <div class="feature-box">
          <div class="feature-icon">
           ğŸ“
          </div>
          <div class="feature-text">
           <div class="feature-text-title">
            Linear Regression
           </div>
           <div class="feature-text-desc">
            Calculate slope, intercept, RÂ² value with visualization
           </div>
          </div>
         </div>
         <div class="feature-box">
          <div class="feature-icon">
           ğŸ²
          </div>
          <div class="feature-text">
           <div class="feature-text-title">
            Probability Engine
           </div>
           <div class="feature-text-desc">
            Binomial &amp; normal distribution calculations
           </div>
          </div>
         </div>
         <div class="feature-box">
          <div class="feature-icon">
           âš¡
          </div>
          <div class="feature-text">
           <div class="feature-text-title">
            Performance Benchmark
           </div>
           <div class="feature-text-desc">
            Compare your data against global averages &amp; percentiles
           </div>
          </div>
         </div>
        </div>
       </div>
       <div class="mb-8">
        <h3 class="text-lg font-bold mb-4">ğŸ“Š All Features</h3>
        <div class="spec-grid">
         <div class="spec-item">
          <div class="spec-value">
           20+
          </div>
          <div class="spec-label">
           Tools &amp; Calculators
          </div>
         </div>
         <div class="spec-item">
          <div class="spec-value">
           10+
          </div>
          <div class="spec-label">
           Games &amp; Challenges
          </div>
         </div>
         <div class="spec-item">
          <div class="spec-value">
           8
          </div>
          <div class="spec-label">
           Chart Types
          </div>
         </div>
         <div class="spec-item">
          <div class="spec-value">
           âˆ
          </div>
          <div class="spec-label">
           Data Points
          </div>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Settings Page -->
     <section id="page-settings" class="page-content hidden">
      <div class="glass-card rounded-2xl p-6 animate-slide-up">
       <h2 class="text-2xl font-bold mb-6">âš™ï¸ Settings</h2><button onclick="exportData()" class="btn-primary w-full mb-3">ğŸ“¥ Export Data</button> <button onclick="clearCache()" class="btn-primary w-full mb-3">ğŸ—‘ï¸ Clear Cache</button> <button onclick="resetAllSettings()" class="w-full py-3 rounded-lg font-semibold bg-red-600/20 border-2 border-red-500/50 text-red-400">ğŸ”„ Reset All</button>
      </div>
     </section>
    </div>
   </main>
  </div>
  <script>
        window.elementSdk.init({
            defaultConfig: {},
            onConfigChange: async (cfg) => {},
            mapToCapabilities: (cfg) => ({ recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined }),
            mapToEditPanelValues: (cfg) => new Map()
        });

        let state = {
            darkMode: true,
            totalCalculations: 0,
            correctAnswers: 0,
            currentStreak: 0,
            progress: { mean: 0, mode: 0, range: 0, median: 0 },
            rewards: { first: false, mean: false, mode: false, range: false, median: false, prediction: false },
            vizData: [],
            charts: {}
        };

        const wordProblems = {
            mean: [
                { text: "Sarah's scores: 85, 92, 78, 95, 88. Mean?", values: [85, 92, 78, 95, 88], answer: 87.6 },
                { text: "Daily steps: 156, 142, 189, 175, 203. Mean?", values: [156, 142, 189, 175, 203], answer: 173 }
            ],
            mode: [
                { text: "Pizza toppings: pepperoni (7), mushroom (3). Mode?", values: [7, 3], answer: 7 },
                { text: "Shoe sizes: 9 (7 times), 10 (4). Mode?", values: [7, 4], answer: 7 }
            ],
            range: [
                { text: "Temp high 95Â°F, low 68Â°F. Range?", values: [95, 68], answer: 27 },
                { text: "Speeds: 88, 92, 85, 94 mph. Range?", values: [88, 92, 85, 94], answer: 9 }
            ],
            median: [
                { text: "Heights: 62, 68, 65, 71, 64. Median?", values: [62, 68, 65, 71, 64], answer: 65 },
                { text: "Scores: 52, 48, 61, 45, 58. Median?", values: [52, 48, 61, 45, 58], answer: 52 }
            ]
        };

        function loadState() {
            const saved = localStorage.getItem('statsState');
            if (saved) state = { ...state, ...JSON.parse(saved) };
            updateAllDisplays();
        }

        function saveState() {
            localStorage.setItem('statsState', JSON.stringify(state));
        }

        function showPage(name) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + name).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.classList.add('inactive'); });
            const btn = document.getElementById('nav-' + name);
            if (btn) { btn.classList.add('active'); btn.classList.remove('inactive'); }
        }

        function showToast(msg, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function toggleDarkLight() {
            state.darkMode = !state.darkMode;
            const html = document.documentElement;
            html.classList.remove(state.darkMode ? 'light-mode' : 'dark-mode');
            html.classList.add(state.darkMode ? 'dark-mode' : 'light-mode');
            const body = document.body;
            body.classList.remove(state.darkMode ? 'light-mode' : 'dark-mode');
            body.classList.add(state.darkMode ? 'dark-mode' : 'light-mode');
            saveState();
            showToast(state.darkMode ? 'ğŸŒ™ Dark mode' : 'â˜€ï¸ Light mode');
        }

        function parseNumbers(input) {
            return input.replace(/\s+/g, ',').split(',').map(n => parseFloat(n.trim())).filter(n => !isNaN(n));
        }

        function mean(arr) { return arr.length === 0 ? 0 : arr.reduce((a, b) => a + b, 0) / arr.length; }
        function median(arr) { const s = [...arr].sort((a, b) => a - b); const m = Math.floor(s.length / 2); return s.length % 2 ? s[m] : (s[m - 1] + s[m]) / 2; }
        function mode(arr) { const f = {}; arr.forEach(n => f[n] = (f[n] || 0) + 1); const mx = Math.max(...Object.values(f)); return Object.keys(f).filter(k => f[k] === mx).map(k => parseFloat(k)); }
        function range(arr) { return arr.length === 0 ? 0 : Math.max(...arr) - Math.min(...arr); }
        function stdev(arr) { const m = mean(arr); const sd = arr.map(n => Math.pow(n - m, 2)); return Math.sqrt(mean(sd)); }

        function calculateMean() {
            const nums = parseNumbers(document.getElementById('mean-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const result = mean(nums);
            document.getElementById('mean-value').textContent = result.toFixed(2);
            document.getElementById('mean-result').classList.remove('hidden');
            state.totalCalculations++; state.correctAnswers++; state.progress.mean++; state.rewards.first = true;
            saveState(); updateAllDisplays(); showToast('âœ“ Mean calculated!', 'success');
        }

        function calculateMode() {
            const nums = parseNumbers(document.getElementById('mode-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const result = mode(nums);
            document.getElementById('mode-value').textContent = result.map(n => n.toFixed(0)).join(', ');
            document.getElementById('mode-result').classList.remove('hidden');
            state.totalCalculations++; state.correctAnswers++; state.progress.mode++; state.rewards.mode = state.progress.mode >= 5;
            saveState(); updateAllDisplays(); showToast('âœ“ Mode found!', 'success');
        }

        function calculateRange() {
            const nums = parseNumbers(document.getElementById('range-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const result = range(nums);
            document.getElementById('range-value').textContent = result.toFixed(2);
            document.getElementById('range-result').classList.remove('hidden');
            state.totalCalculations++; state.correctAnswers++; state.progress.range++; state.rewards.range = state.progress.range >= 5;
            saveState(); updateAllDisplays(); showToast('âœ“ Range calculated!', 'success');
        }

        function calculateMedian() {
            const nums = parseNumbers(document.getElementById('median-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const result = median(nums);
            document.getElementById('median-value').textContent = result.toFixed(2);
            document.getElementById('median-result').classList.remove('hidden');
            state.totalCalculations++; state.correctAnswers++; state.progress.median++; state.rewards.median = state.progress.median >= 5;
            saveState(); updateAllDisplays(); showToast('âœ“ Median calculated!', 'success');
        }

        function calculateVariance() {
            const nums = parseNumbers(document.getElementById('variance-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const m = mean(nums); const variance = mean(nums.map(n => Math.pow(n - m, 2)));
            const sd = Math.sqrt(variance); const cv = (sd / m) * 100;
            document.getElementById('variance-value').textContent = variance.toFixed(2);
            document.getElementById('stdev-value').textContent = sd.toFixed(2);
            document.getElementById('cv-value').textContent = cv.toFixed(2) + '%';
            document.getElementById('variance-result').classList.remove('hidden');
            showToast('âœ“ Variance calculated!', 'success');
        }

        function calculateQuartiles() {
            const nums = parseNumbers(document.getElementById('quartiles-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const sorted = [...nums].sort((a, b) => a - b);
            const q1 = median(sorted.slice(0, Math.floor(sorted.length / 2)));
            const q2 = median(sorted);
            const q3 = median(sorted.slice(Math.ceil(sorted.length / 2)));
            const iqr = q3 - q1;
            let html = `<tr><td>Q1</td><td>${q1.toFixed(2)}</td></tr>`;
            html += `<tr><td>Q2 (Median)</td><td>${q2.toFixed(2)}</td></tr>`;
            html += `<tr><td>Q3</td><td>${q3.toFixed(2)}</td></tr>`;
            html += `<tr><td><strong>IQR</strong></td><td><strong>${iqr.toFixed(2)}</strong></td></tr>`;
            document.getElementById('quartiles-body').innerHTML = html;
            document.getElementById('quartiles-result').classList.remove('hidden');
            showToast('âœ“ Quartiles calculated!', 'success');
        }

        function findOutliers() {
            const nums = parseNumbers(document.getElementById('outliers-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            const sorted = [...nums].sort((a, b) => a - b);
            const q1 = median(sorted.slice(0, Math.floor(sorted.length / 2)));
            const q3 = median(sorted.slice(Math.ceil(sorted.length / 2)));
            const iqr = q3 - q1;
            const lower = q1 - 1.5 * iqr;
            const upper = q3 + 1.5 * iqr;
            const outliers = nums.filter(n => n < lower || n > upper);
            let html = '';
            if (outliers.length === 0) html = '<p class="text-slate-400">âœ“ No outliers detected</p>';
            else { html += `<p class="font-semibold mb-3">Found ${outliers.length} outlier(s):</p>`; outliers.forEach(o => { html += `<div class="bg-red-600/20 p-3 rounded text-red-400">ğŸ¯ ${o.toFixed(2)}</div>`; }); }
            document.getElementById('outliers-result').innerHTML = html;
            document.getElementById('outliers-result').classList.remove('hidden');
            showToast('âœ“ Outliers found!', 'success');
        }

        function calculateCorrelation() {
            const x = parseNumbers(document.getElementById('corr-x').value);
            const y = parseNumbers(document.getElementById('corr-y').value);
            if (x.length === 0 || y.length === 0 || x.length !== y.length) { showToast('Equal length datasets needed', 'error'); return; }
            const mx = mean(x); const my = mean(y); const sx = stdev(x); const sy = stdev(y);
            const r = mean(x.map((v, i) => ((v - mx) / sx) * ((y[i] - my) / sy)));
            document.getElementById('correlation-value').textContent = r.toFixed(3);
            document.getElementById('correlation-result').classList.remove('hidden');
            showToast('âœ“ Correlation calculated!', 'success');
        }

        function runPrediction() {
            const nums = parseNumbers(document.getElementById('pred-input').value);
            if (nums.length < 2) { showToast('Need at least 2 values', 'error'); return; }
            const diffs = [];
            for (let i = 1; i < nums.length; i++) { diffs.push(nums[i] - nums[i-1]); }
            const avgDiff = mean(diffs);
            const next = nums[nums.length - 1] + avgDiff;
            const next2 = next + avgDiff;
            const next3 = next2 + avgDiff;
            const confidence = Math.min(100, (nums.length / 10) * 100);
            document.getElementById('pred-next').textContent = next.toFixed(2);
            document.getElementById('pred-next2').textContent = next2.toFixed(2);
            document.getElementById('pred-next3').textContent = next3.toFixed(2);
            document.getElementById('pred-confidence').textContent = confidence.toFixed(0) + '%';
            document.getElementById('prediction-result').classList.remove('hidden');
            state.rewards.prediction = true;
            state.totalCalculations++;
            saveState(); updateAllDisplays(); showToast('ğŸ”® Prediction complete!', 'success');
        }

        function runRegression() {
            const x = parseNumbers(document.getElementById('reg-x').value);
            const y = parseNumbers(document.getElementById('reg-y').value);
            if (x.length === 0 || y.length === 0 || x.length !== y.length) { showToast('Equal length datasets needed', 'error'); return; }
            const mx = mean(x); const my = mean(y);
            const numerator = mean(x.map((v, i) => (v - mx) * (y[i] - my)));
            const denominator = mean(x.map(v => Math.pow(v - mx, 2)));
            const slope = numerator / denominator;
            const intercept = my - slope * mx;
            const predictions = x.map(v => slope * v + intercept);
            const ssRes = mean(y.map((v, i) => Math.pow(v - predictions[i], 2)));
            const ssTot = mean(y.map(v => Math.pow(v - my, 2)));
            const r2 = 1 - (ssRes / ssTot);
            document.getElementById('reg-slope').textContent = slope.toFixed(3);
            document.getElementById('reg-intercept').textContent = intercept.toFixed(3);
            document.getElementById('reg-r2').textContent = r2.toFixed(3);
            document.getElementById('reg-equation').textContent = `y = ${slope.toFixed(2)}x + ${intercept.toFixed(2)}`;
            document.getElementById('regression-result').classList.remove('hidden');
            document.getElementById('regression-chart').classList.remove('hidden');
            setTimeout(() => renderRegressionChart(x, y, slope, intercept), 100);
            state.totalCalculations++;
            saveState(); showToast('ğŸ“ Regression calculated!', 'success');
        }

        function renderRegressionChart(x, y, slope, intercept) {
            const ctx = document.getElementById('regressionChart');
            if (!ctx) return;
            try { if (state.charts.regression) state.charts.regression.destroy(); } catch (e) {}
            const predictions = x.map(v => slope * v + intercept);
            state.charts.regression = new Chart(ctx, {
                type: 'scatter', data: {
                    datasets: [
                        { label: 'Data Points', data: x.map((v, i) => ({x: v, y: y[i]})), backgroundColor: 'rgba(99, 102, 241, 0.6)', pointRadius: 5 },
                        { label: 'Regression Line', data: x.map((v, i) => ({x: v, y: predictions[i]})), type: 'line', borderColor: '#ec4899', borderWidth: 2, fill: false, tension: 0 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } }, x: { ticks: { color: '#94a3b8' } } } }
            });
        }

        function calculateBinomial() {
            const n = parseInt(document.getElementById('bin-n').value);
            const p = parseFloat(document.getElementById('bin-p').value);
            const k = parseInt(document.getElementById('bin-k').value);
            if (isNaN(n) || isNaN(p) || isNaN(k)) { showToast('Invalid input', 'error'); return; }
            const factorial = (n) => n <= 1 ? 1 : n * factorial(n - 1);
            const binom = (factorial(n) / (factorial(k) * factorial(n - k))) * Math.pow(p, k) * Math.pow(1 - p, n - k);
            document.getElementById('bin-prob').textContent = binom.toFixed(4);
            document.getElementById('binomial-result').classList.remove('hidden');
            showToast('âœ“ Binomial calculated!', 'success');
        }

        function calculateNormal() {
            const mean = parseFloat(document.getElementById('norm-mean').value);
            const std = parseFloat(document.getElementById('norm-std').value);
            const x = parseFloat(document.getElementById('norm-x').value);
            if (isNaN(mean) || isNaN(std) || isNaN(x)) { showToast('Invalid input', 'error'); return; }
            const z = (x - mean) / std;
            const p = 0.5 * (1 + erf(z / Math.sqrt(2)));
            const erf = (x) => { const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911; const sign = x < 0 ? -1 : 1; x = Math.abs(x); const t = 1.0 / (1.0 + p * x); const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x); return sign * y; };
            document.getElementById('norm-prob').textContent = p.toFixed(4);
            document.getElementById('normal-result').classList.remove('hidden');
            showToast('âœ“ Normal distribution calculated!', 'success');
        }

        function runBenchmark() {
            const nums = parseNumbers(document.getElementById('bench-data').value);
            if (nums.length === 0) { showToast('Enter valid data', 'error'); return; }
            const avg = mean(nums);
            const globalAvg = 50;
            const similar = globalAvg * (nums.length / 20);
            const percentile = Math.min(100, (avg / (globalAvg * 2)) * 100);
            const rating = percentile > 75 ? 'Excellent' : percentile > 50 ? 'Good' : percentile > 25 ? 'Fair' : 'Below Average';
            document.getElementById('bench-global').textContent = ((avg / globalAvg) * 100).toFixed(0) + '%';
            document.getElementById('bench-similar').textContent = ((avg / similar) * 100).toFixed(0) + '%';
            document.getElementById('bench-percentile').textContent = percentile.toFixed(0) + 'th';
            document.getElementById('bench-rating').textContent = rating;
            document.getElementById('benchmark-result').classList.remove('hidden');
            showToast('âš¡ Benchmark complete!', 'success');
        }

        function processVisualizerData() {
            state.vizData = parseNumbers(document.getElementById('viz-input').value);
            if (state.vizData.length === 0) { showToast('Enter valid data', 'error'); return; }
            setTimeout(() => { renderLineChart(); renderBarChart(); renderPieChart(); }, 100);
            showToast('âœ“ Data processed!', 'success'); saveState();
        }

        function renderLineChart() {
            if (state.vizData.length === 0) return;
            const ctx = document.getElementById('lineChart');
            if (!ctx) return;
            try { if (state.charts.line) state.charts.line.destroy(); } catch (e) {}
            state.charts.line = new Chart(ctx, {
                type: 'line', data: { labels: state.vizData.map((_, i) => i + 1), datasets: [{ label: 'Data', data: state.vizData, borderColor: '#6366f1', backgroundColor: 'rgba(99, 102, 241, 0.1)', borderWidth: 2, fill: true, tension: 0.3, pointRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } }, x: { ticks: { color: '#94a3b8' } } } }
            });
        }

        function renderBarChart() {
            if (state.vizData.length === 0) return;
            const ctx = document.getElementById('barChart');
            if (!ctx) return;
            try { if (state.charts.bar) state.charts.bar.destroy(); } catch (e) {}
            state.charts.bar = new Chart(ctx, {
                type: 'bar', data: { labels: state.vizData.map((_, i) => i + 1), datasets: [{ label: 'Values', data: state.vizData, backgroundColor: 'rgba(139, 92, 246, 0.8)', borderColor: '#8b5cf6', borderWidth: 2 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } }, x: { ticks: { color: '#94a3b8' } } } }
            });
        }

        function renderPieChart() {
            if (state.vizData.length === 0) return;
            const ctx = document.getElementById('pieChart');
            if (!ctx) return;
            try { if (state.charts.pie) state.charts.pie.destroy(); } catch (e) {}
            state.charts.pie = new Chart(ctx, {
                type: 'doughnut', data: { labels: state.vizData.map((_, i) => `P${i + 1}`), datasets: [{ data: state.vizData, backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#06b6d4', '#3b82f6'], borderColor: '#0f172a', borderWidth: 2 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } } }
            });
        }

        function switchAdvancedTab(name) {
            document.querySelectorAll('#page-advanced .tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            document.querySelectorAll('#page-advanced .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function generateRawTable() {
            const nums = parseNumbers(document.getElementById('table-input').value);
            if (nums.length === 0) { showToast('Enter valid numbers', 'error'); return; }
            let html = '<table class="data-table"><thead><tr><th>#</th><th>Value</th></tr></thead><tbody>';
            nums.forEach((val, idx) => { html += `<tr><td>${idx + 1}</td><td>${val.toFixed(2)}</td></tr>`; });
            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html;
            state.vizData = nums; showToast('âœ“ Table generated!', 'success'); saveState();
        }

        function generateFrequencyTable() {
            if (state.vizData.length === 0) { state.vizData = parseNumbers(document.getElementById('table-input').value); if (state.vizData.length === 0) { showToast('Enter data first', 'error'); return; } }
            const freq = {}; state.vizData.forEach(val => { const key = val.toFixed(1); freq[key] = (freq[key] || 0) + 1; });
            let html = '<table class="data-table"><thead><tr><th>Value</th><th>Frequency</th></tr></thead><tbody>';
            const total = state.vizData.length;
            Object.entries(freq).sort((a, b) => parseFloat(a[0]) - parseFloat(b[0])).forEach(([val, count]) => { html += `<tr><td>${val}</td><td>${count}</td></tr>`; });
            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html; showToast('âœ“ Frequency table generated!', 'success'); saveState();
        }

        function generateStatsTable() {
            if (state.vizData.length === 0) { state.vizData = parseNumbers(document.getElementById('table-input').value); if (state.vizData.length === 0) { showToast('Enter data first', 'error'); return; } }
            let html = '<table class="data-table"><thead><tr><th>Statistic</th><th>Value</th></tr></thead><tbody>';
            const stats = { 'Mean': mean(state.vizData), 'Median': median(state.vizData), 'Min': Math.min(...state.vizData), 'Max': Math.max(...state.vizData), 'Range': range(state.vizData), 'Std Dev': stdev(state.vizData), 'Count': state.vizData.length };
            Object.entries(stats).forEach(([stat, val]) => { html += `<tr><td>${stat}</td><td>${typeof val === 'number' ? val.toFixed(2) : val}</td></tr>`; });
            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html; showToast('âœ“ Stats table generated!', 'success'); saveState();
        }

        function generateProblem(type) {
            const problems = wordProblems[type];
            state.currentProblem = problems[Math.floor(Math.random() * problems.length)];
            state.problemType = type;
            document.getElementById('problem-area').classList.remove('hidden');
            document.getElementById('problem-text').textContent = state.currentProblem.text;
            document.getElementById('problem-answer').value = '';
            document.getElementById('problem-feedback').classList.add('hidden');
            showToast('Problem ready!', 'info');
        }

        function checkProblemAnswer() {
            if (!state.currentProblem) { showToast('Generate a problem first', 'error'); return; }
            const answer = parseFloat(document.getElementById('problem-answer').value);
            if (isNaN(answer)) { showToast('Enter a valid number', 'error'); return; }
            const tolerance = 0.1; const isCorrect = Math.abs(answer - state.currentProblem.answer) < tolerance;
            const feedback = document.getElementById('problem-feedback');
            if (isCorrect) {
                feedback.innerHTML = '<div class="success-badge">âœ“ Correct!</div>';
                state.currentStreak++;
            } else {
                feedback.innerHTML = `<div style="background: rgba(239, 68, 68, 0.1); color: #fca5a5; padding: 12px; border-radius: 6px;">âœ— Answer: ${state.currentProblem.answer.toFixed(2)}</div>`;
                state.currentStreak = 0;
            }
            state.totalCalculations++; feedback.classList.remove('hidden'); saveState(); updateAllDisplays();
        }

        function skipProblem() {
            state.currentStreak = 0; state.totalCalculations++; saveState();
            document.getElementById('problem-area').classList.add('hidden'); updateAllDisplays(); showToast('Problem skipped', 'info');
        }

        function startGuessGame() {
            const nums = [12, 45, 78, 23, 91];
            state.guessProblem = { hint: 'Find the middle number', values: nums, answer: median(nums) };
            document.getElementById('start-guess').classList.add('hidden');
            document.getElementById('guess-game').classList.remove('hidden');
            document.getElementById('guess-hint').textContent = 'Numbers: ' + nums.join(', ');
        }

        function submitGuess() {
            const answer = parseFloat(document.getElementById('guess-input').value);
            if (isNaN(answer)) { showToast('Enter a valid number', 'error'); return; }
            const tolerance = 0.5; const isCorrect = Math.abs(answer - state.guessProblem.answer) < tolerance;
            const feedback = document.getElementById('guess-feedback');
            feedback.innerHTML = isCorrect ? '<div class="success-badge">âœ“ Correct!</div>' : `<div style="color: #fca5a5;">âœ— Answer: ${state.guessProblem.answer.toFixed(2)}</div>`;
            feedback.classList.remove('hidden');
            showToast(isCorrect ? 'âœ“ Great guess!' : 'âœ— Try again', isCorrect ? 'success' : 'error');
        }

        function giveUpGuess() {
            document.getElementById('guess-feedback').innerHTML = `<div style="color: #94a3b8;">Answer was: ${state.guessProblem.answer.toFixed(2)}</div>`;
            document.getElementById('guess-feedback').classList.remove('hidden');
        }

        function startSpeedChallenge() {
            document.getElementById('speed-time').textContent = '30';
            document.getElementById('speed-correct').textContent = '0';
            document.getElementById('speed-game').classList.remove('hidden');
            state.speedStart = Date.now(); state.speedCorrect = 0;
            generateSpeedQuestion();
            const interval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - state.speedStart) / 1000);
                const remaining = Math.max(0, 30 - elapsed);
                document.getElementById('speed-time').textContent = remaining;
                if (remaining === 0) { clearInterval(interval); showToast('Time up!', 'error'); document.getElementById('speed-game').classList.add('hidden'); }
            }, 100);
        }

        function generateSpeedQuestion() {
            const types = ['mean', 'median', 'mode', 'range'];
            const type = types[Math.floor(Math.random() * types.length)];
            const nums = [12, 34, 56, 78, 90];
            let question = '', answer = 0;
            if (type === 'mean') { question = `Mean of ${nums.join(', ')}`; answer = mean(nums); }
            else if (type === 'median') { question = `Median of ${nums.join(', ')}`; answer = median(nums); }
            else if (type === 'mode') { question = 'Mode of 1,2,2,3,3,3?'; answer = 3; }
            else { question = `Range of ${nums.join(', ')}`; answer = range(nums); }
            document.getElementById('speed-question').textContent = question;
            state.speedAnswer = answer; state.speedInput = document.getElementById('speed-input');
            state.speedInput.value = '';
        }

        function submitSpeedAnswer() {
            const answer = parseFloat(state.speedInput.value);
            if (isNaN(answer)) return;
            if (Math.abs(answer - state.speedAnswer) < 0.1) { state.speedCorrect++; document.getElementById('speed-correct').textContent = state.speedCorrect; }
            generateSpeedQuestion();
        }

        function spinWheel() {
            const wheel = document.getElementById('luck-wheel');
            wheel.classList.add('animate-spin');
            setTimeout(() => {
                wheel.classList.remove('animate-spin');
                const rewards = ['ğŸ 50 pts', 'â­ 100 pts', 'ğŸ’ 200 pts', 'ğŸ”¥ 150 pts', 'ğŸ† 300 pts'];
                const reward = rewards[Math.floor(Math.random() * rewards.length)];
                document.getElementById('luck-result').innerHTML = `<div style="text-align: center; font-size: 20px; font-weight: bold;">${reward}</div>`;
                document.getElementById('luck-result').classList.remove('hidden');
                showToast('You won: ' + reward, 'success');
            }, 1000);
        }

        function startPatternGame() {
            const patterns = [
                { sequence: [2, 4, 6, 8], next: 10, name: 'Even Numbers' },
                { sequence: [1, 3, 5, 7], next: 9, name: 'Odd Numbers' },
                { sequence: [1, 2, 4, 8], next: 16, name: 'Powers' },
                { sequence: [1, 1, 2, 3, 5], next: 8, name: 'Fibonacci' }
            ];
            state.pattern = patterns[Math.floor(Math.random() * patterns.length)];
            document.getElementById('pattern-sequence').textContent = state.pattern.sequence.join(', ') + ', ?';
            document.getElementById('start-pattern').classList.add('hidden');
            document.getElementById('pattern-game').classList.remove('hidden');
        }

        function checkPattern() {
            const answer = parseFloat(document.getElementById('pattern-input').value);
            if (isNaN(answer)) { showToast('Enter a number', 'error'); return; }
            const feedback = document.getElementById('pattern-feedback');
            const isCorrect = Math.abs(answer - state.pattern.next) < 0.5;
            feedback.innerHTML = isCorrect ? '<div class="success-badge">âœ“ Correct! ' + state.pattern.name + '</div>' : `<div style="color: #fca5a5;">âœ— Answer: ${state.pattern.next}</div>`;
            feedback.classList.remove('hidden');
        }

        function loadLesson(topic) {
            const lessons = {
                mean: '<h3 class="font-bold mb-2">ğŸ“Š Mean (Average)</h3><p>The mean is the sum of all values divided by the count. Example: (2+4+6)/3 = 4</p>',
                median: '<h3 class="font-bold mb-2">ğŸª Median</h3><p>The middle value when sorted. For [1,2,3,4,5] median is 3</p>',
                mode: '<h3 class="font-bold mb-2">ğŸ¯ Mode</h3><p>The most frequent value. In [1,2,2,3] mode is 2</p>',
                range: '<h3 class="font-bold mb-2">ğŸ“ Range</h3><p>The difference between max and min. For [1,5,10] range is 10-1=9</p>'
            };
            document.getElementById('lesson-content').innerHTML = lessons[topic] || 'Select a lesson';
        }

        function updateAllDisplays() {
            const total = state.totalCalculations || 1;
            document.getElementById('progress-mean').style.width = Math.min(state.progress.mean * 20, 100) + '%';
            document.getElementById('progress-mean-text').textContent = Math.min(state.progress.mean * 20, 100) + '%';
            document.getElementById('progress-mode').style.width = Math.min(state.progress.mode * 20, 100) + '%';
            document.getElementById('progress-mode-text').textContent = Math.min(state.progress.mode * 20, 100) + '%';
            document.getElementById('progress-range').style.width = Math.min(state.progress.range * 20, 100) + '%';
            document.getElementById('progress-range-text').textContent = Math.min(state.progress.range * 20, 100) + '%';
            document.getElementById('progress-median').style.width = Math.min(state.progress.median * 20, 100) + '%';
            document.getElementById('progress-median-text').textContent = Math.min(state.progress.median * 20, 100) + '%';
            document.getElementById('reward-first').classList.toggle('earned', state.rewards.first);
            document.getElementById('reward-mean').classList.toggle('earned', state.rewards.mean);
            document.getElementById('reward-mode').classList.toggle('earned', state.rewards.mode);
            document.getElementById('reward-range').classList.toggle('earned', state.rewards.range);
            document.getElementById('reward-median').classList.toggle('earned', state.rewards.median);
            document.getElementById('reward-prediction').classList.toggle('earned', state.rewards.prediction);
            const lb = [{ name: 'You', points: state.totalCalculations * 10, rank: 1 }, { name: 'Stats Wizard', points: 1500, rank: 2 }, { name: 'Math Master', points: 1200, rank: 3 }];
            document.getElementById('leaderboard-list').innerHTML = lb.map(p => `<div style="display: flex; justify-content: space-between; padding: 12px; background: var(--card-bg); border-radius: 8px; margin: 4px 0;"><span>${p.rank === 1 ? 'ğŸ¥‡' : p.rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'} ${p.name}</span><span style="font-weight: bold;">${p.points}</span></div>`).join('');
        }

        function clearCache() { localStorage.clear(); state = { darkMode: true, totalCalculations: 0, correctAnswers: 0, currentStreak: 0, progress: { mean: 0, mode: 0, range: 0, median: 0 }, rewards: { first: false, mean: false, mode: false, range: false, median: false, prediction: false }, vizData: [], charts: {} }; updateAllDisplays(); showToast('âœ“ Cache cleared!', 'success'); }

        function exportData() { const data = JSON.stringify(state, null, 2); const blob = new Blob([data], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'stats-progress.json'; a.click(); showToast('âœ“ Data exported!', 'success'); }

        function resetAllSettings() { if (confirm('Reset all?')) { clearCache(); showToast('âœ“ Reset!', 'success'); } }

        loadState();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cc3c65fe4e7fd7d',t:'MTc3MDgxMjE2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>